# Следующие шаги

## Текущий этап: Фаза 3, Шаг 3.1

### Фаза 3: Расчёт заработка

**Цель фазы:** Реализовать автоматический расчёт заработка по смене с учётом переработок, прогрессивных ставок и дополнительных услуг.

---

### Шаг 3.1: Таблицы для настроек профессии

**Задача:** Добавить таблицы для хранения настроек оплаты.

**Что нужно сделать:**

1. Обновить `database.py` - добавить в `init_db()`:
   - Таблица `professions` - основные настройки профессии
   - Таблица `progressive_rates` - прогрессивные ставки переработки
   - Таблица `additional_services` - дополнительные услуги
   - Таблица `shift_services` - связь смен и услуг
   - Таблица `earnings` - расчёты заработка

2. Добавить функции:
   - `create_profession()` - создание профессии
   - `get_profession_by_project()` - получение профессии проекта
   - `add_progressive_rate()` - добавление прогрессивной ставки
   - И другие функции для работы с таблицами

3. Протестировать создание и получение данных

**После выполнения:**
- Протестировать с test_professions.py
- Обновить STATUS.md
- Сделать коммит: "Шаг 3.1: Таблицы для настроек профессии"
- Перейти к Шагу 3.2

---

### Следующие шаги Фазы 3:

**Шаг 3.2:** Временное создание профессии для тестов
- Автоматически создавать базовую профессию при создании проекта
- Позволит начать тестирование расчётов

**Шаг 3.3:** Модуль calculator.py
- Создать функцию `calculate_shift_earnings()`
- Реализовать алгоритм расчёта:
  - Базовая оплата
  - Переработки (с прогрессивными ставками)
  - Суточные
  - Дополнительные услуги
  - Итого (нетто и брутто)

**Шаг 3.4:** Автоматический расчёт при подтверждении
- Интегрировать calculator.py в shifts.py
- После подтверждения смены → автоматический расчёт
- Показывать детальную карточку с расчётом

**Шаг 3.5:** Прогрессивные ставки переработки
- Улучшить алгоритм расчёта
- Поддержка нескольких диапазонов ставок
- Детальная разбивка по диапазонам

**Время на Фазу 3:** ~1 неделя

---

## Завершённые фазы

### Фаза 2: AI-парсинг ✅
- ✅ Модуль parser.py с OpenAI интеграцией
- ✅ Обработка текстовых сообщений
- ✅ Таблица shifts в БД
- ✅ Сохранение подтверждённых смен
- ✅ Улучшение парсера для гибкости

### Фаза 1: Базовый бот + БД ✅
- ✅ Структура проекта
- ✅ Регистрация пользователей
- ✅ Создание проектов
- ✅ FSM для диалогов